# Migration `watch-20191019015349`

This migration has been generated by velasko at 10/19/2019, 1:53:50 AM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
DROP TABLE "alicialonso-dev"."Post";

CREATE TABLE "alicialonso-dev"."Role" (
  "createdAt" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,
  "id" text NOT NULL  ,
  "name" text NOT NULL DEFAULT '' ,
  "updatedAt" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,
  PRIMARY KEY ("id")
);

CREATE TABLE "alicialonso-dev"."SocialLink" (
  "id" text NOT NULL  ,
  "link" text NOT NULL DEFAULT '' ,
  "owner" text   REFERENCES "alicialonso-dev"."User"("id") ON DELETE SET NULL,
  PRIMARY KEY ("id")
);

CREATE TABLE "alicialonso-dev"."SocialNetwork" (
  "baseURL" text NOT NULL DEFAULT '' ,
  "id" text NOT NULL  ,
  "name" text NOT NULL DEFAULT '' ,
  "ownURL" text NOT NULL DEFAULT '' ,
  PRIMARY KEY ("id")
);

CREATE TABLE "alicialonso-dev"."OfficialDocument" (
  "createdAt" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,
  "expiration" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,
  "id" text NOT NULL  ,
  "number" text NOT NULL DEFAULT '' ,
  "other" text   ,
  "owner" text   REFERENCES "alicialonso-dev"."User"("id") ON DELETE SET NULL,
  "type" text NOT NULL DEFAULT 'NATIONALID' ,
  "updatedAt" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,
  PRIMARY KEY ("id")
);

CREATE TABLE "alicialonso-dev"."Address" (
  "address1" text NOT NULL DEFAULT '' ,
  "address2" text   ,
  "city" text   ,
  "code" text NOT NULL DEFAULT '' ,
  "country" text NOT NULL DEFAULT '' ,
  "createdAt" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,
  "id" text NOT NULL  ,
  "owner" text   REFERENCES "alicialonso-dev"."User"("id") ON DELETE SET NULL,
  "primary" boolean NOT NULL DEFAULT false ,
  "region" text NOT NULL DEFAULT '' ,
  "updatedAt" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,
  PRIMARY KEY ("id")
);

CREATE TABLE "alicialonso-dev"."Device" (
  "countryCode" text   ,
  "createdAt" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,
  "id" text NOT NULL  ,
  "notificationsDevice" text NOT NULL DEFAULT '' ,
  "notificationsPermission" boolean NOT NULL DEFAULT true ,
  "number" text   ,
  "owner" text   REFERENCES "alicialonso-dev"."User"("id") ON DELETE SET NULL,
  "type" text NOT NULL DEFAULT 'PHONE' ,
  "updatedAt" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,
  "verified" boolean NOT NULL DEFAULT false ,
  PRIMARY KEY ("id")
);

CREATE TABLE "alicialonso-dev"."Department" (
  "id" text NOT NULL  ,
  "name" text NOT NULL DEFAULT '' ,
  PRIMARY KEY ("id")
);

CREATE TABLE "alicialonso-dev"."Estudio" (
  "createdAt" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,
  "description" text   ,
  "id" text NOT NULL  ,
  "name" text NOT NULL DEFAULT '' ,
  "shortName" text NOT NULL DEFAULT '' ,
  "updatedAt" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,
  PRIMARY KEY ("id")
);

CREATE TABLE "alicialonso-dev"."Titulacion" (
  "code" text NOT NULL DEFAULT '' ,
  "createdAt" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,
  "description" text   ,
  "id" text NOT NULL  ,
  "name" text NOT NULL DEFAULT '' ,
  "shortName" text NOT NULL DEFAULT '' ,
  "updatedAt" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,
  PRIMARY KEY ("id")
);

CREATE TABLE "alicialonso-dev"."Asignatura" (
  "code" text NOT NULL DEFAULT '' ,
  "createdAt" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,
  "creditosECTS" integer NOT NULL DEFAULT 0 ,
  "description" text   ,
  "horasBalance" integer NOT NULL DEFAULT 0 ,
  "horasSemanasPlanificadas" integer NOT NULL DEFAULT 0 ,
  "horasSemanasPresenciales" integer NOT NULL DEFAULT 0 ,
  "horasTotalesPlanificadas" integer NOT NULL DEFAULT 0 ,
  "horasTotalesPresenciales" integer NOT NULL DEFAULT 0 ,
  "id" text NOT NULL  ,
  "name" text NOT NULL DEFAULT '' ,
  "semsestre" text NOT NULL DEFAULT 'SEMESTRE_1' ,
  "shortName" text NOT NULL DEFAULT '' ,
  "spacerequirements" text   ,
  "updatedAt" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,
  PRIMARY KEY ("id")
);

CREATE TABLE "alicialonso-dev"."Ratio" (
  "id" text NOT NULL  ,
  "multiplier" integer NOT NULL DEFAULT 0 ,
  "name" text NOT NULL DEFAULT '' ,
  PRIMARY KEY ("id")
);

CREATE TABLE "alicialonso-dev"."Curso" (
  "createdAt" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,
  "id" text NOT NULL  ,
  "identifier" text NOT NULL DEFAULT '' ,
  "updatedAt" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,
  PRIMARY KEY ("id")
);

CREATE TABLE "alicialonso-dev"."Desdoble" (
  "createdAt" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,
  "id" text NOT NULL  ,
  "updatedAt" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,
  PRIMARY KEY ("id")
);

CREATE TABLE "alicialonso-dev"."Mencion" (
  "createdAt" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,
  "id" text NOT NULL  ,
  "name" text NOT NULL DEFAULT '' ,
  "shortName" text NOT NULL DEFAULT '' ,
  "updatedAt" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,
  PRIMARY KEY ("id")
);

CREATE TABLE "alicialonso-dev"."Matricula" (
  "alumno" text   REFERENCES "alicialonso-dev"."User"("id") ON DELETE SET NULL,
  "createdAt" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,
  "id" text NOT NULL  ,
  "updatedAt" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,
  PRIMARY KEY ("id")
);

CREATE TABLE "alicialonso-dev"."Leccion" (
  "createdAt" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,
  "gestor" text   REFERENCES "alicialonso-dev"."User"("id") ON DELETE SET NULL,
  "id" text NOT NULL  ,
  "name" text NOT NULL DEFAULT '' ,
  "updatedAt" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,
  PRIMARY KEY ("id")
);

CREATE TABLE "alicialonso-dev"."Recurrencia" (
  "createdAt" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,
  "id" text NOT NULL  ,
  "timeEnd" text NOT NULL DEFAULT '' ,
  "timeStart" text NOT NULL DEFAULT '' ,
  "updatedAt" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,
  "weekday" text NOT NULL DEFAULT 'LUNES' ,
  PRIMARY KEY ("id")
);

CREATE TABLE "alicialonso-dev"."ConvocatoriaExamen" (
  "createdAt" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,
  "dateEnd" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,
  "dateStart" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,
  "id" text NOT NULL  ,
  "name" text NOT NULL DEFAULT '' ,
  "updatedAt" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,
  PRIMARY KEY ("id")
);

CREATE TABLE "alicialonso-dev"."PeriodoOperativo" (
  "createdAt" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,
  "id" text NOT NULL  ,
  "updatedAt" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,
  "yearEnd" integer NOT NULL DEFAULT 0 ,
  "yearStart" integer NOT NULL DEFAULT 0 ,
  PRIMARY KEY ("id")
);

CREATE TABLE "alicialonso-dev"."Examen" (
  "createdAt" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,
  "dateTime" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,
  "endTime" text NOT NULL DEFAULT '' ,
  "id" text NOT NULL  ,
  "updatedAt" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,
  PRIMARY KEY ("id")
);

CREATE TABLE "alicialonso-dev"."Sesion" (
  "by" text   REFERENCES "alicialonso-dev"."User"("id") ON DELETE SET NULL,
  "closedAt" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,
  "createdAt" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,
  "id" text NOT NULL  ,
  "updatedAt" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,
  PRIMARY KEY ("id")
);

CREATE TABLE "alicialonso-dev"."Asistencia" (
  "atendida" boolean NOT NULL DEFAULT false ,
  "dispensada" boolean NOT NULL DEFAULT false ,
  "estudiante" text   REFERENCES "alicialonso-dev"."User"("id") ON DELETE SET NULL,
  "id" text NOT NULL  ,
  "justificada" boolean NOT NULL DEFAULT false ,
  PRIMARY KEY ("id")
);

CREATE TABLE "alicialonso-dev"."News" (
  "author" text   REFERENCES "alicialonso-dev"."User"("id") ON DELETE SET NULL,
  "body" text NOT NULL DEFAULT '' ,
  "category" text NOT NULL DEFAULT 'NEWS' ,
  "createdAt" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,
  "expiration" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,
  "featured" boolean NOT NULL DEFAULT false ,
  "id" text NOT NULL  ,
  "imageURL" text   ,
  "status" text NOT NULL DEFAULT 'DRAFT' ,
  "subtitle" text NOT NULL DEFAULT '' ,
  "target" text NOT NULL DEFAULT 'ESTUDIANTE' ,
  "title" text NOT NULL DEFAULT '' ,
  "updatedAt" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,
  PRIMARY KEY ("id")
);

CREATE TABLE "alicialonso-dev"."Event" (
  "access" text   ,
  "accessPoint" text   ,
  "author" text   REFERENCES "alicialonso-dev"."User"("id") ON DELETE SET NULL,
  "body" text NOT NULL DEFAULT '' ,
  "createdAt" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,
  "date" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,
  "id" text NOT NULL  ,
  "imageURL" text   ,
  "organizer" text   ,
  "status" text NOT NULL DEFAULT 'DRAFT' ,
  "subtitle" text NOT NULL DEFAULT '' ,
  "target" text NOT NULL DEFAULT 'ESTUDIANTE' ,
  "title" text NOT NULL DEFAULT '' ,
  "updatedAt" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,
  PRIMARY KEY ("id")
);

CREATE TABLE "alicialonso-dev"."Venue" (
  "address" text NOT NULL DEFAULT '' ,
  "createdAt" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,
  "id" text NOT NULL  ,
  "latitude" Decimal(65,30) NOT NULL DEFAULT 0 ,
  "longitude" Decimal(65,30) NOT NULL DEFAULT 0 ,
  "name" text NOT NULL DEFAULT '' ,
  "placeID" text NOT NULL DEFAULT '' ,
  "updatedAt" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,
  PRIMARY KEY ("id")
);

CREATE TABLE "alicialonso-dev"."Space" (
  "createdAt" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,
  "id" text NOT NULL  ,
  "name" text NOT NULL DEFAULT '' ,
  "updatedAt" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,
  PRIMARY KEY ("id")
);

CREATE TABLE "alicialonso-dev"."ContentDocument" (
  "body" text NOT NULL DEFAULT '' ,
  "createdAt" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,
  "creator" text   REFERENCES "alicialonso-dev"."User"("id") ON DELETE SET NULL,
  "id" text NOT NULL  ,
  "metadata" text NOT NULL DEFAULT '' ,
  "subtitle" text NOT NULL DEFAULT '' ,
  "title" text NOT NULL DEFAULT '' ,
  "updatedAt" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,
  PRIMARY KEY ("id")
);

CREATE TABLE "alicialonso-dev"."MediaCategory" (
  "createdAt" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,
  "id" text NOT NULL  ,
  "name" text NOT NULL DEFAULT '' ,
  "updatedAt" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,
  PRIMARY KEY ("id")
);

CREATE TABLE "alicialonso-dev"."Media" (
  "createdAt" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,
  "id" text NOT NULL  ,
  "metadata" text NOT NULL DEFAULT '' ,
  "name" text NOT NULL DEFAULT '' ,
  "updatedAt" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,
  "uploader" text   REFERENCES "alicialonso-dev"."User"("id") ON DELETE SET NULL,
  "url" text NOT NULL DEFAULT '' ,
  PRIMARY KEY ("id")
);

CREATE TABLE "alicialonso-dev"."ProductCategory" (
  "createdAt" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,
  "id" text NOT NULL  ,
  "name" text NOT NULL DEFAULT '' ,
  "updatedAt" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,
  PRIMARY KEY ("id")
);

CREATE TABLE "alicialonso-dev"."Product" (
  "content" text NOT NULL DEFAULT '' ,
  "createdAt" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,
  "description" text NOT NULL DEFAULT '' ,
  "id" text NOT NULL  ,
  "name" text NOT NULL DEFAULT '' ,
  "unitPrice" Decimal(65,30) NOT NULL DEFAULT 0 ,
  "updatedAt" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,
  PRIMARY KEY ("id")
);

CREATE TABLE "alicialonso-dev"."Discount" (
  "code" text NOT NULL DEFAULT '' ,
  "createdAt" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,
  "description" text NOT NULL DEFAULT '' ,
  "id" text NOT NULL  ,
  "name" text NOT NULL DEFAULT '' ,
  "requirements" text NOT NULL DEFAULT '' ,
  "unitPrice" Decimal(65,30) NOT NULL DEFAULT 0 ,
  "updatedAt" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,
  PRIMARY KEY ("id")
);

CREATE TABLE "alicialonso-dev"."DiscountRequest" (
  "applied" boolean NOT NULL DEFAULT false ,
  "approved" boolean NOT NULL DEFAULT false ,
  "createdAt" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,
  "id" text NOT NULL  ,
  "updatedAt" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,
  "user" text   REFERENCES "alicialonso-dev"."User"("id") ON DELETE SET NULL,
  PRIMARY KEY ("id")
);

CREATE TABLE "alicialonso-dev"."Transaction" (
  "amount" integer NOT NULL DEFAULT 0 ,
  "createdAt" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,
  "id" text NOT NULL  ,
  "reference" text NOT NULL DEFAULT '' ,
  "type" text NOT NULL DEFAULT 'SALE' ,
  "updatedAt" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,
  PRIMARY KEY ("id")
);

CREATE TABLE "alicialonso-dev"."Order" (
  "createdAt" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,
  "customer" text   REFERENCES "alicialonso-dev"."User"("id") ON DELETE SET NULL,
  "id" text NOT NULL  ,
  "metadata" text NOT NULL DEFAULT '' ,
  "paymentDue" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,
  "paymentSettled" boolean NOT NULL DEFAULT false ,
  "reference" text NOT NULL DEFAULT '' ,
  "total" Decimal(65,30) NOT NULL DEFAULT 0 ,
  "updatedAt" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,
  "vatRate" integer NOT NULL DEFAULT 0 ,
  PRIMARY KEY ("id")
);

CREATE TABLE "alicialonso-dev"."Item" (
  "createdAt" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,
  "id" text NOT NULL  ,
  "orderPrice" Decimal(65,30) NOT NULL DEFAULT 0 ,
  "quantity" integer NOT NULL DEFAULT 0 ,
  "updatedAt" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,
  PRIMARY KEY ("id")
);

CREATE TABLE "alicialonso-dev"."Product_imageURLs" (
  "nodeId" text   REFERENCES "alicialonso-dev"."Product"("id") ON DELETE CASCADE,
  "position" integer NOT NULL  ,
  "value" text NOT NULL  ,
  PRIMARY KEY ("nodeId","position")
);

CREATE TABLE "alicialonso-dev"."DiscountRequest_documentation" (
  "nodeId" text   REFERENCES "alicialonso-dev"."DiscountRequest"("id") ON DELETE CASCADE,
  "position" integer NOT NULL  ,
  "value" text NOT NULL  ,
  PRIMARY KEY ("nodeId","position")
);

CREATE TABLE "alicialonso-dev"."_UserRoles" (
  "A" text   REFERENCES "alicialonso-dev"."Role"("id") ON DELETE CASCADE,
  "B" text   REFERENCES "alicialonso-dev"."User"("id") ON DELETE CASCADE
);

CREATE TABLE "alicialonso-dev"."_ProfesoresLecciones" (
  "A" text   REFERENCES "alicialonso-dev"."Leccion"("id") ON DELETE CASCADE,
  "B" text   REFERENCES "alicialonso-dev"."User"("id") ON DELETE CASCADE
);

CREATE TABLE "alicialonso-dev"."_LeccionEspaciosPlanificados" (
  "A" text   REFERENCES "alicialonso-dev"."Recurrencia"("id") ON DELETE CASCADE,
  "B" text   REFERENCES "alicialonso-dev"."Space"("id") ON DELETE CASCADE
);

ALTER TABLE "alicialonso-dev"."User" DROP COLUMN "name",
ADD COLUMN "avatar" text   ,
ADD COLUMN "createdAt" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,
ADD COLUMN "department" text   REFERENCES "alicialonso-dev"."Department"("id") ON DELETE SET NULL,
ADD COLUMN "emailVerified" boolean NOT NULL DEFAULT false ,
ADD COLUMN "firstname" text NOT NULL DEFAULT '' ,
ADD COLUMN "group" text NOT NULL DEFAULT 'PUBLIC' ,
ADD COLUMN "groupRequest" text   ,
ADD COLUMN "isAdmin" boolean NOT NULL DEFAULT false ,
ADD COLUMN "lastname" text NOT NULL DEFAULT '' ,
ADD COLUMN "metadata" text NOT NULL DEFAULT '' ,
ADD COLUMN "password" text NOT NULL DEFAULT '' ,
ADD COLUMN "updatedAt" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ;

ALTER TABLE "alicialonso-dev"."SocialLink" ADD COLUMN "socialNetwork" text   REFERENCES "alicialonso-dev"."SocialNetwork"("id") ON DELETE SET NULL;

ALTER TABLE "alicialonso-dev"."Titulacion" ADD COLUMN "estudio" text   REFERENCES "alicialonso-dev"."Estudio"("id") ON DELETE SET NULL;

ALTER TABLE "alicialonso-dev"."Asignatura" ADD COLUMN "curso" text   REFERENCES "alicialonso-dev"."Curso"("id") ON DELETE SET NULL,
ADD COLUMN "ratio" text   REFERENCES "alicialonso-dev"."Ratio"("id") ON DELETE SET NULL,
ADD COLUMN "titulacion" text   REFERENCES "alicialonso-dev"."Titulacion"("id") ON DELETE SET NULL;

ALTER TABLE "alicialonso-dev"."Desdoble" ADD COLUMN "asignatura" text   REFERENCES "alicialonso-dev"."Asignatura"("id") ON DELETE SET NULL,
ADD COLUMN "lecciones" text   REFERENCES "alicialonso-dev"."Leccion"("id") ON DELETE SET NULL,
ADD COLUMN "mencion" text   REFERENCES "alicialonso-dev"."Mencion"("id") ON DELETE SET NULL;

ALTER TABLE "alicialonso-dev"."Matricula" ADD COLUMN "desdoble" text   REFERENCES "alicialonso-dev"."Desdoble"("id") ON DELETE SET NULL;

ALTER TABLE "alicialonso-dev"."Leccion" ADD COLUMN "periodo" text   REFERENCES "alicialonso-dev"."PeriodoOperativo"("id") ON DELETE SET NULL;

ALTER TABLE "alicialonso-dev"."Recurrencia" ADD COLUMN "leccion" text   REFERENCES "alicialonso-dev"."Leccion"("id") ON DELETE SET NULL;

ALTER TABLE "alicialonso-dev"."ConvocatoriaExamen" ADD COLUMN "periodo" text   REFERENCES "alicialonso-dev"."PeriodoOperativo"("id") ON DELETE SET NULL;

ALTER TABLE "alicialonso-dev"."Examen" ADD COLUMN "convocatoria" text   REFERENCES "alicialonso-dev"."ConvocatoriaExamen"("id") ON DELETE SET NULL,
ADD COLUMN "espacio" text   REFERENCES "alicialonso-dev"."Space"("id") ON DELETE SET NULL,
ADD COLUMN "leccion" text   REFERENCES "alicialonso-dev"."Leccion"("id") ON DELETE SET NULL;

ALTER TABLE "alicialonso-dev"."Sesion" ADD COLUMN "at" text   REFERENCES "alicialonso-dev"."Space"("id") ON DELETE SET NULL,
ADD COLUMN "leccion" text   REFERENCES "alicialonso-dev"."Leccion"("id") ON DELETE SET NULL;

ALTER TABLE "alicialonso-dev"."Asistencia" ADD COLUMN "sesion" text   REFERENCES "alicialonso-dev"."Sesion"("id") ON DELETE SET NULL;

ALTER TABLE "alicialonso-dev"."Event" ADD COLUMN "place" text   REFERENCES "alicialonso-dev"."Space"("id") ON DELETE SET NULL;

ALTER TABLE "alicialonso-dev"."Space" ADD COLUMN "venue" text   REFERENCES "alicialonso-dev"."Venue"("id") ON DELETE SET NULL;

ALTER TABLE "alicialonso-dev"."Media" ADD COLUMN "category" text   REFERENCES "alicialonso-dev"."MediaCategory"("id") ON DELETE SET NULL;

ALTER TABLE "alicialonso-dev"."Product" ADD COLUMN "category" text   REFERENCES "alicialonso-dev"."ProductCategory"("id") ON DELETE SET NULL;

ALTER TABLE "alicialonso-dev"."Discount" ADD COLUMN "product" text   REFERENCES "alicialonso-dev"."Product"("id") ON DELETE SET NULL;

ALTER TABLE "alicialonso-dev"."DiscountRequest" ADD COLUMN "discount" text   REFERENCES "alicialonso-dev"."Discount"("id") ON DELETE SET NULL;

ALTER TABLE "alicialonso-dev"."Transaction" ADD COLUMN "order" text   REFERENCES "alicialonso-dev"."Order"("id") ON DELETE SET NULL;

ALTER TABLE "alicialonso-dev"."Item" ADD COLUMN "discount" text   REFERENCES "alicialonso-dev"."Discount"("id") ON DELETE SET NULL,
ADD COLUMN "order" text   REFERENCES "alicialonso-dev"."Order"("id") ON DELETE SET NULL,
ADD COLUMN "product" text   REFERENCES "alicialonso-dev"."Product"("id") ON DELETE SET NULL;

CREATE UNIQUE INDEX "SocialLink.link" ON "alicialonso-dev"."SocialLink"("link")

CREATE UNIQUE INDEX "OfficialDocument.number" ON "alicialonso-dev"."OfficialDocument"("number")

CREATE UNIQUE INDEX "Device.notificationsDevice" ON "alicialonso-dev"."Device"("notificationsDevice")

CREATE UNIQUE INDEX "Estudio.name" ON "alicialonso-dev"."Estudio"("name")

CREATE UNIQUE INDEX "Estudio.shortName" ON "alicialonso-dev"."Estudio"("shortName")

CREATE UNIQUE INDEX "Titulacion.name" ON "alicialonso-dev"."Titulacion"("name")

CREATE UNIQUE INDEX "Titulacion.shortName" ON "alicialonso-dev"."Titulacion"("shortName")

CREATE UNIQUE INDEX "Titulacion.code" ON "alicialonso-dev"."Titulacion"("code")

CREATE UNIQUE INDEX "Asignatura.name" ON "alicialonso-dev"."Asignatura"("name")

CREATE UNIQUE INDEX "Asignatura.shortName" ON "alicialonso-dev"."Asignatura"("shortName")

CREATE UNIQUE INDEX "Asignatura.code" ON "alicialonso-dev"."Asignatura"("code")

CREATE UNIQUE INDEX "Ratio.name" ON "alicialonso-dev"."Ratio"("name")

CREATE UNIQUE INDEX "Curso.identifier" ON "alicialonso-dev"."Curso"("identifier")

CREATE UNIQUE INDEX "Mencion.name" ON "alicialonso-dev"."Mencion"("name")

CREATE UNIQUE INDEX "Mencion.shortName" ON "alicialonso-dev"."Mencion"("shortName")

CREATE UNIQUE INDEX "MediaCategory.name" ON "alicialonso-dev"."MediaCategory"("name")

CREATE UNIQUE INDEX "ProductCategory.name" ON "alicialonso-dev"."ProductCategory"("name")

CREATE UNIQUE INDEX "Order.reference" ON "alicialonso-dev"."Order"("reference")

CREATE UNIQUE INDEX "_UserRoles_AB_unique" ON "alicialonso-dev"."_UserRoles"("A","B")

CREATE UNIQUE INDEX "_ProfesoresLecciones_AB_unique" ON "alicialonso-dev"."_ProfesoresLecciones"("A","B")

CREATE UNIQUE INDEX "_LeccionEspaciosPlanificados_AB_unique" ON "alicialonso-dev"."_LeccionEspaciosPlanificados"("A","B")
```

## Changes

```diff
diff --git datamodel.mdl datamodel.mdl
migration watch-20191018202356..watch-20191019015349
--- datamodel.dml
+++ datamodel.dml
@@ -3,23 +3,583 @@
 }
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url      = env("DATABASE_URL")
 }
+// ###############################################################################################################
+// USER
+// ###############################################################################################################
+
 model User {
-  id    String  @default(cuid()) @id
-  email String  @unique
-  name  String?
-  posts Post[]
+    id                      String         		@id @default(uuid())
+    createdAt               DateTime    		@default(now())
+    updatedAt               DateTime    		@updatedAt
+
+    firstname               String
+    lastname                String
+    email                   String 				@unique
+    emailVerified           Boolean				@default(false)
+    password				String
+    
+    group					UserGroup			@default(PUBLIC)
+    groupRequest			UserGroup?
+
+    isAdmin					Boolean 			@default(false)
+    roles 					Role[]				@relation(name: "UserRoles")
+    
+    avatar					String?
+    addresses				Address[] 			@relation(name: "UserAddress", onDelete: CASCADE)
+    devices					Device[] 			@relation(name: "UserDevices", onDelete: CASCADE)
+    officialDocuments		OfficialDocument[]	@relation(name: "UserOfficialDocuments", onDelete: CASCADE)
+    socialNetworkLinks		SocialLink[]	 	@relation(name: "UserSocialNetworks", onDelete: CASCADE)
+    metadata				String
+
+    department				Department          @relation(name: "DepartmentMembers", onDelete: NONE)
+
+    newses                  News[]              @relation(name: "UserNewses", onDelete: CASCADE)
+    events                  Event[]             @relation(name: "UserEvents", onDelete: CASCADE)
+
+    matriculas              Matricula[]         @relation(name: "AlumnoMatriculas", onDelete: CASCADE)
+    asistencias             Asistencia[]        @relation(name: "EstudianteAsistencias", onDelete: CASCADE)
+
+    leccionesGestionadas    Leccion[]           @relation(name: "LeccionGestor")
+    leccionesDisponibles    Leccion[]           @relation(name: "ProfesoresLecciones", onDelete: CASCADE)
+    sesiones                Sesion[]            @relation(name: "SesionesEjecutadas", onDelete: CASCADE)
+
+    orders                  Order[]             @relation(name: "CustomerOrders", onDelete: NONE)
+    discountRequests        DiscountRequest[]   @relation(name: "UserDiscountRequests", onDelete: CASCADE)
 }
-model Post {
-  id        String   @default(cuid()) @id
-  createdAt DateTime @default(now())
-  updatedAt DateTime @updatedAt
-  published Boolean  @default(true)
-  title     String
-  content   String?
-  author    User?
-}
+enum UserGroup {
+    ESTUDIANTE
+    STAFF
+    GENERAL
+}
+
+enum OfficialDocumentType {
+    NATIONALID
+    PASSPORT
+    SOCIALSECURITY
+    DRIVINGLICENSE
+    OTHER
+}
+
+model Role {
+    id                      String              @id @default(uuid())
+    createdAt               DateTime            @default(now())
+    updatedAt               DateTime            @updatedAt
+
+    name                    String
+    users                   User[]              @relation(name: "UserRoles")
+}
+
+model SocialLink {
+    id                      String              @id @default(uuid())
+    link                    String              @unique
+    socialNetwork           SocialNetwork       @relation(name: "LinkSocialNetwork", onDelete: NONE)
+    owner                   User                @relation(name: "UserSocialNetworks", onDelete: NONE)
+}
+
+model SocialNetwork {
+    id                      String              @id @default(uuid())
+    name                    String
+    baseURL                 String
+    ownURL                  String
+    userLinks               SocialLink[]        @relation(name: "LinkSocialNetwork", onDelete: CASCADE)
+}
+
+model OfficialDocument {
+    id                      String              @id @default(uuid())
+    createdAt               DateTime            @default(now())
+    updatedAt               DateTime            @updatedAt
+
+    number                  String              @unique
+    type                    OfficialDocumentType @default(NATIONALID)
+    other                   String?
+    expiration              DateTime
+    owner                   User                @relation(name: "UserOfficialDocuments", onDelete: NONE)
+}
+
+model Address {
+    id                      String              @id @default(uuid())
+    createdAt               DateTime            @default(now())
+    updatedAt               DateTime            @updatedAt
+
+    owner                   User                @relation(name: "UserAddress", onDelete: NONE)
+    address1                String
+    address2                String?
+    city                    String?
+    region                  String
+    country                 String
+    code                    String
+    primary                 Boolean             @default(false)
+}
+
+enum DeviceType {
+    PHONE
+    TABLET
+    OTHER
+}
+
+model Device {
+    id                      String              @id @default(uuid())
+    createdAt               DateTime            @default(now())
+    updatedAt               DateTime            @updatedAt
+
+    owner                   User                @relation(name: "UserDevices", onDelete: NONE)
+    countryCode             String?
+    number                  String?
+    type                    DeviceType          @default(PHONE)
+
+    notificationsDevice     String              @unique                                     // external ID from expo:
+    notificationsPermission Boolean             @default(true)
+    verified                Boolean             @default(false)
+}
+
+model Department {
+    id                      String              @id @default(uuid())
+    name                    String
+    members                 User[]              @relation(name: "DepartmentMembers", onDelete: NONE)
+}
+
+// ###############################################################################################################
+// ACADEMIC
+// ###############################################################################################################
+
+model Estudio {
+    id                      String              @id @default(uuid())
+    createdAt               DateTime            @default(now())
+    updatedAt               DateTime            @updatedAt
+
+    name                    String              @unique
+    shortName               String              @unique
+    description             String?
+
+    titulaciones            Titulacion[]        @relation(name: "EstudioTitulaciones", onDelete: CASCADE)
+}
+
+model Titulacion {
+    id                      String              @id @default(uuid())
+    createdAt               DateTime            @default(now())
+    updatedAt               DateTime            @updatedAt
+
+    name                    String              @unique
+    shortName               String              @unique
+    code                    String              @unique
+    description             String?
+
+    estudio                 Estudio             @relation(name: "EstudioTitulaciones", onDelete: NONE)
+    asignaturas             Asignatura[]        @relation(name: "TitulacionAsignaturas", onDelete: CASCADE)
+}
+
+enum Semestre {
+    SEMESTRE_1
+    SEMESTRE_2
+    ANUAL
+}
+
+model Asignatura {
+    id                      String              @id @default(uuid())
+    createdAt               DateTime            @default(now())
+    updatedAt               DateTime            @updatedAt
+
+    name                    String              @unique
+    shortName               String              @unique
+    code                    String              @unique
+    description             String?
+    spacerequirements       String?
+    creditosECTS            Int                 @default(0)
+    horasTotalesPresenciales Int                @default(0)    // calc multiplying creaditos * ratio
+    horasSemanasPresenciales Int                @default(0)    // calc division de horas totales segun semestre
+    horasSemanasPlanificadas Int                @default(0)    // numero de horas planificadas a la semana
+    horasTotalesPlanificadas Int                @default(0)    // total de horas de la planificacion 
+    horasBalance            Int                 @default(0)     // diferencia entre horasTotalesPresenciales y estadoRealHorasTotalesPlanificadas
+
+    titulacion              Titulacion          @relation(name: "TitulacionAsignaturas", onDelete: NONE)
+    curso                   Curso               @relation(name: "CursoAsignaturas", onDelete: NONE)
+    desdobles               Desdoble[]          @relation(name: "AsignaturaDesdobles", onDelete: CASCADE)
+    semsestre               Semestre            @default(SEMESTRE_1)
+    ratio                   Ratio               @relation(name: "RatioAsignaturas", onDelete: NONE)
+}
+
+model Ratio {
+    id                      String              @id @default(uuid())
+
+    name                    String              @unique
+    multiplier              Int                 @default(0)
+
+    asignaturas             Asignatura[]        @relation(name: "RatioAsignaturas", onDelete: CASCADE)
+}
+
+model Curso {
+    id                      String              @id @default(uuid())
+    createdAt               DateTime            @default(now())
+    updatedAt               DateTime            @updatedAt
+
+    identifier              String              @unique
+
+    asignaturas             Asignatura[]        @relation(name: "CursoAsignaturas", onDelete: CASCADE)
+}
+
+model Desdoble {
+    id                      String              @id @default(uuid())
+    createdAt               DateTime            @default(now())
+    updatedAt               DateTime            @updatedAt
+
+    asignatura              Asignatura          @relation(name: "AsignaturaDesdobles", onDelete: NONE)
+    mencion                 Mencion             @relation(name: "MencionDesdobles", onDelete: NONE)
+    matriculas              Matricula[]         @relation(name: "DesdobleMatriculas", onDelete: CASCADE)
+    lecciones               Leccion             @relation(name: "DesdobleLecciones", onDelete: CASCADE)
+}
+
+model Mencion {
+    id                      String              @id @default(uuid())
+    createdAt               DateTime            @default(now())
+    updatedAt               DateTime            @updatedAt
+
+    name                    String              @unique
+    shortName               String              @unique
+
+    desdobles               Desdoble[]          @relation(name: "MencionDesdobles", onDelete: CASCADE)
+}
+
+model Matricula {
+    id                      String              @id @default(uuid())
+    createdAt               DateTime            @default(now())
+    updatedAt               DateTime            @updatedAt
+
+    alumno                  User                @relation(name: "AlumnoMatriculas", onDelete: NONE)
+    desdoble                Desdoble            @relation(name: "DesdobleMatriculas", onDelete: NONE)
+}
+
+model Leccion {
+    id                      String              @id @default(uuid())
+    createdAt               DateTime            @default(now())
+    updatedAt               DateTime            @updatedAt
+
+    name                    String 
+    recurrencias            Recurrencia[]       @relation(name: "LeccionRecurrencias", onDelete: CASCADE)
+    examenes                Examen[]            @relation(name: "LeccionExamenes", onDelete: CASCADE)
+
+    desdobles               Desdoble[]          @relation(name: "DesdobleLecciones", onDelete: NONE)
+    periodo                 PeriodoOperativo    @relation(name: "PeriodoOperativoLecciones", onDelete: NONE)
+    sesiones                Sesion[]            @relation(name: "LeccionSesiones", onDelete: NONE)
+    gestor                  User                @relation(name: "LeccionGestor", onDelete: NONE)
+    profesoresDisponibles   User[]              @relation(name: "ProfesoresLecciones", onDelete: CASCADE)
+}
+
+enum WeekDay {
+    DOMINGO
+    LUNES
+    MARTES
+    MIERCOLES
+    JUEVES
+    VIERNES
+    SABADO
+}
+
+model Recurrencia {
+    id                      String              @id @default(uuid())
+    createdAt               DateTime            @default(now())
+    updatedAt               DateTime            @updatedAt
+
+    leccion                 Leccion             @relation(name: "LeccionRecurrencias", onDelete: NONE)
+    weekday                 WeekDay             @default(LUNES)
+    timeStart               String
+    timeEnd                 String
+    plannedSpaces           Space[]             @relation(name: "LeccionEspaciosPlanificados", onDelete: CASCADE)
+}
+
+model ConvocatoriaExamen {
+    id                      String              @id @default(uuid())
+    createdAt               DateTime            @default(now())
+    updatedAt               DateTime            @updatedAt
+
+    name                    String 
+    dateStart               DateTime 
+    dateEnd                 DateTime 
+
+    periodo                 PeriodoOperativo    @relation(name: "PeriodoOperativoExamenes", onDelete: NONE)
+    examenes                Examen[]            @relation(name: "ConvocatoriaExamenes", onDelete: CASCADE)
+}
+
+model PeriodoOperativo {
+    id                      String              @id @default(uuid())
+    createdAt               DateTime            @default(now())
+    updatedAt               DateTime            @updatedAt
+
+    yearStart               Int 
+    yearEnd                 Int 
+    lecciones               Leccion[]           @relation(name: "PeriodoOperativoLecciones", onDelete: CASCADE)
+    convocatoriasExamenes   ConvocatoriaExamen[] @relation(name: "PeriodoOperativoExamenes", onDelete: CASCADE)
+}
+
+model Examen {
+    id                      String              @id @default(uuid())
+    createdAt               DateTime            @default(now())
+    updatedAt               DateTime            @updatedAt
+
+    leccion                 Leccion             @relation(name: "LeccionExamenes", onDelete: NONE)
+    espacio                 Space               @relation(name: "EspacioExamenes", onDelete: NONE)
+    convocatoria            ConvocatoriaExamen  @relation(name: "ConvocatoriaExamenes", onDelete: NONE)
+    dateTime                DateTime 
+    endTime                 String 
+}
+
+model Sesion {
+    id                      String              @id @default(uuid())
+    createdAt               DateTime            @default(now())
+    updatedAt               DateTime            @updatedAt
+
+    leccion                 Leccion             @relation(name: "LeccionSesiones", onDelete: NONE)
+    closedAt                DateTime 
+    by                      User                @relation(name: "SesionesEjecutadas", onDelete: NONE)
+    at                      Space               @relation(name: "EspacioSesiones", onDelete: NONE)
+    asistencia              Asistencia[]        @relation(name: "SesionAsistencias", onDelete: CASCADE)
+}
+
+model Asistencia {
+    id                      String              @id @default(uuid())
+
+    atendida                Boolean             @default(false)
+    dispensada              Boolean             @default(false)
+    justificada             Boolean             @default(false)
+
+    sesion                  Sesion              @relation(name: "SesionAsistencias", onDelete: NONE)
+    estudiante              User                @relation(name: "EstudianteAsistencias", onDelete: NONE)  
+}
+
+// type LeccionSesiones @relationTable {
+//     leccion: Leccion 
+//     sesion: Sesion 
+// }
+
+// type ProfesoresLecciones @relationTable {
+//     profesor: User 
+//     leccion: Leccion 
+// }
+
+// type LeccionEspaciosPlanificados @relationTable {
+//     recurrencia: Recurrencia 
+//     espacio: Space 
+// }
+
+// ###############################################################################################################
+// APP
+// ###############################################################################################################
+
+enum AppNodeStatus {
+    DRAFT
+    PUBLISHED
+    DEFERED
+}
+
+enum NewsFeedCategories {
+    NEWS
+    ALERT
+    CALL
+}
+model News {
+    id                      String              @id @default(uuid())
+    createdAt               DateTime            @default(now())
+    updatedAt               DateTime            @updatedAt
+
+    author                  User                @relation(name: "UserNewses", onDelete: NONE)
+    title                   String 
+    subtitle                String
+    body                    String 
+    imageURL                String?
+    expiration              DateTime
+    category                NewsFeedCategories  @default(NEWS)
+    featured                Boolean             @default(false)
+    target                  UserGroup 
+    status                  AppNodeStatus       @default(DRAFT)
+}
+
+model Event {
+    id                      String              @id @default(uuid())
+    createdAt               DateTime            @default(now())
+    updatedAt               DateTime            @updatedAt
+
+    author                  User                @relation(name: "UserEvents", onDelete: NONE)
+    title                   String 
+    subtitle                String
+    organizer               String?
+    body                    String 
+    imageURL                String?
+    date                    DateTime 
+    access                  String?
+    accessPoint             String?
+    target                  UserGroup 
+    status                  AppNodeStatus       @default(DRAFT)
+    place                   Space               @relation(name: "EventVenueSpace", onDelete: NONE)
+}
+
+model Venue {
+    id                      String              @id @default(uuid())
+    createdAt               DateTime            @default(now())
+    updatedAt               DateTime            @updatedAt
+
+    name                    String 
+    address                 String 
+    placeID                 String
+    latitude                Float
+    longitude               Float
+    spaces                  Space[]             @relation(name: "VenueSpaces", onDelete: CASCADE)
+}
+
+model Space {
+    id                      String              @id @default(uuid())
+    createdAt               DateTime            @default(now())
+    updatedAt               DateTime            @updatedAt
+
+    name                    String 
+    venue                   Venue               @relation(name: "VenueSpaces", onDelete: NONE)
+    events                  Event[]             @relation(name: "EventVenueSpace", onDelete: CASCADE)
+    sesiones                Sesion[]            @relation(name: "EspacioSesiones", onDelete: CASCADE)
+    leccionesPlanificadas   Recurrencia[]       @relation(name: "LeccionEspaciosPlanificados", onDelete: CASCADE)
+    examenes                Examen[]            @relation(name: "EspacioExamenes", onDelete: CASCADE)
+}
+
+// ###############################################################################################################
+// SHARED
+// ###############################################################################################################
+
+model ContentDocument {
+    id                      String              @id @default(uuid())
+    createdAt               DateTime            @default(now())
+    updatedAt               DateTime            @updatedAt
+
+    creator                 User
+    title                   String 
+    subtitle                String
+    body                    String 
+    metadata                String
+}
+
+model MediaCategory {
+    id                      String              @id @default(uuid())
+    createdAt               DateTime            @default(now())
+    updatedAt               DateTime            @updatedAt
+
+    name                    String              @unique
+    files                   Media[]             @relation(name: "CategoryMedias", onDelete: CASCADE)
+}
+
+model Media {
+    id                      String              @id @default(uuid())
+    createdAt               DateTime            @default(now())
+    updatedAt               DateTime            @updatedAt
+
+    uploader                User
+    name                    String 
+    url                     String 
+    category                MediaCategory       @relation(name: "CategoryMedias", onDelete: NONE)
+    metadata                String
+}
+
+// ###############################################################################################################
+// STORE
+// ###############################################################################################################
+
+model ProductCategory {
+    id                      String              @id @default(uuid())
+    createdAt               DateTime            @default(now())
+    updatedAt               DateTime            @updatedAt
+
+    name                    String              @unique
+    products                Product[]           @relation(name: "ProductCategories", onDelete: NONE)
+}
+
+model Product {
+    id                      String              @id @default(uuid())
+    createdAt               DateTime            @default(now())
+    updatedAt               DateTime            @updatedAt
+
+    name                    String 
+    description             String 
+    content                 String
+    unitPrice               Float 
+    category                ProductCategory     @relation(name: "ProductCategories", onDelete: NONE)
+    imageURLs               String[]            @scalarList(strategy: RELATION)
+    discounts               Discount[]          @relation(name: "ProductDiscounts", onDelete: CASCADE)
+    orders                  Item[]              @relation(name: "ProductsInOrder")
+}
+
+model Discount {
+    id                      String              @id @default(uuid())
+    createdAt               DateTime            @default(now())
+    updatedAt               DateTime            @updatedAt
+
+    product                 Product             @relation(name: "ProductDiscounts", onDelete: NONE)
+    name                    String 
+    description             String 
+
+    code                    String
+    unitPrice               Float 
+    discountRequests        DiscountRequest[]   @relation(name: "DiscountRequests", onDelete: CASCADE)
+
+    requirements            String 
+}
+
+
+model DiscountRequest {
+    id                      String              @id @default(uuid())
+    createdAt               DateTime            @default(now())
+    updatedAt               DateTime            @updatedAt
+
+    discount                Discount            @relation(name: "DiscountRequests", onDelete: NONE)
+    user                    User                @relation(name: "UserDiscountRequests", onDelete: NONE)
+    applied                 Boolean             @default(false)
+    approved                Boolean             @default(false)
+    documentation           String[]            @scalarList(strategy: RELATION)
+}
+
+enum TxType {
+    SALE
+    PURCHASE
+    RECEIPT
+    PAYMENT
+} 
+
+model Transaction {
+    id                      String              @id @default(uuid())
+    createdAt               DateTime            @default(now())
+    updatedAt               DateTime            @updatedAt
+
+    type                    TxType              @default(SALE)
+    reference               String                                                      // in the case of TPV transactions this field is Ds_AuthorisationCode
+    order                   Order               @relation(name: "OrderTransactions", onDelete: NONE)
+    amount                  Int                                                         // transaction amounts must be in cents of euro (1 / 100)
+}
+
+model Order {
+    id                      String              @id @default(uuid())
+    createdAt               DateTime            @default(now())
+    updatedAt               DateTime            @updatedAt
+
+    customer                User                @relation(name: "CustomerOrders", onDelete: NONE)
+    items                   Item[]              @relation(name: "OrderItems", onDelete: CASCADE)
+    reference               String              @unique
+    metadata                String
+
+    paymentSettled          Boolean             @default(false)
+    paymentDue              DateTime
+    transactions            Transaction[]       @relation(name: "OrderTransactions", onDelete: CASCADE)
+
+    vatRate                 Int                 @default(0)
+    total                   Float 
+}
+
+model Item {
+    id                      String              @id @default(uuid())
+    createdAt               DateTime            @default(now())
+    updatedAt               DateTime            @updatedAt
+
+    order                   Order               @relation(name: "OrderItems", onDelete: NONE)
+    product                 Product             @relation(name: "ProductsInOrder", onDelete: NONE)
+    discount                Discount?
+    quantity                Int 
+    orderPrice              Float                                                       // this price either from a product or a discount
+}
```

## Photon Usage

You can use a specific Photon built for this migration (watch-20191019015349)
in your `before` or `after` migration script like this:

```ts
import Photon from '@generated/photon/watch-20191019015349'

const photon = new Photon()

async function main() {
  const result = await photon.users()
  console.dir(result, { depth: null })
}

main()

```
